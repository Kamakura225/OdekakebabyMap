<h2 class="mb-4">ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚³ãƒ¡ãƒ³ãƒˆä¸€è¦§</h2>

<div class="mb-3">
  <%= link_to "ğŸ‘ ã„ã„ã­é †", admin_comments_path(sort: 'good'), class: "btn btn-outline-primary btn-sm me-2" %>
  <%= link_to "ğŸ‘ ã‚ˆããªã„é †", admin_comments_path(sort: 'bad'), class: "btn btn-outline-secondary btn-sm me-2" %>
  <%= link_to "ğŸ•’ æ–°ç€é †", admin_comments_path, class: "btn btn-outline-dark btn-sm" %>
</div>

<table class="table table-hover align-middle table-bordered">
  <thead class="table-light">
    <tr>
      <th>æŠ•ç¨¿è€…</th>
      <th>ã‚³ãƒ¡ãƒ³ãƒˆå†…å®¹</th>
      <th>å¯¾è±¡æ–½è¨­</th>
      <th>è©•ä¾¡ãƒ»ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³</th>
      <th>æŠ•ç¨¿æ—¥</th>
      <th>æ“ä½œ</th>
    </tr>
  </thead>
  <tbody>
    <% @comments.each do |comment| %>
      <tr>
        <td><%= comment.user.nickname %></td>
        <td><%= simple_format(comment.content) %></td>
        <td><%= link_to comment.place.name, admin_place_path(comment.place), class: "text-decoration-none" %></td>
        <td>
          <div class="d-flex flex-column align-items-start">
            <div class="rating mb-1" data-score="<%= comment.rating %>"></div>
            <div>
              <span class="badge bg-success me-1">
                <i class="fa-solid fa-thumbs-up me-1"></i>
                <span id="like-count-<%= comment.id %>"><%= comment.likes.good.count %></span>
              </span>
              <span class="badge bg-danger">
                <i class="fa-solid fa-thumbs-down me-1"></i>
                <span id="dislike-count-<%= comment.id %>"><%= comment.likes.bad.count %></span>
              </span>
            </div>
          </div>
        </td>
        <td><%= l(comment.created_at, format: :short) %></td>
        <td>
          <%= link_to 'å‰Šé™¤', admin_comment_path(comment), method: :delete,
                data: { confirm: 'æœ¬å½“ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ' },
                class: 'btn btn-sm btn-outline-danger' %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>

<script>
  document.addEventListener("turbolinks:load", () => {
  const target = document.getElementById("star-rating");  
  
  // è¡¨ç¤ºç”¨  
  document.querySelectorAll(".rating").forEach((elem) => {
    elem.innerHTML = '';
    const score = parseFloat(elem.dataset.score || 0);
    raty(elem, {
      score: score,
      readOnly: true, // ã‚³ãƒ¡ãƒ³ãƒˆè¡¨ç¤ºã¯èª­å–å°‚ç”¨      
      starOn: url("../assets/raty/star-on.png"),
      starOff: url("../assets/raty/star-off.png"),
      starHalf: url("../assets/raty/star-half.png"),
      halfShow: true,
    });
  });
});
</script>
